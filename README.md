# SourceConcat.jl

[![CI](https://github.com/josePereiro/SourceConcat.jl/actions/workflows/CI.yml/badge.svg)](https://github.com/josePereiro/SourceConcat.jl/actions/workflows/CI.yml)
[![License: MIT](https://img.shields.io/badge/License-MIT-blue.svg)](LICENSE)
[![Julia](https://img.shields.io/badge/julia-%5E1.10-blue?logo=julia)](https://julialang.org/)

> Concatenate your projectâ€™s source files into a single, navigable Markdown document â€” complete with syntax highlighting, table of contents, and clipboard export.

---

## âœ¨ Overview

**SourceConcat.jl** walks your source tree, collects files that match glob patterns, and concatenates them into a single Markdown file.

Itâ€™s handy for:
- Building *context packs* for AI tools or documentation
- Creating portable snapshots of a codebase
- Rapid code reviews and shareable archives

---

## âš™ï¸ Installation

```julia
using Pkg
Pkg.add(url="https://github.com/josePereiro/SourceConcat.jl.git")
````

---

## ðŸš€ Quick start

1. Put a configuration file at your project root named **`SourceConcat.json`** *(or `SrcConcat.json`)*.
2. From Julia, call:

```julia
using SourceConcat
concat(log = true)
```

### Output modes

| Mode               | Description                                                              |
| ------------------ | ------------------------------------------------------------------------ |
| `"file"`           | Write concatenated Markdown to `output.path`.                            |
| `"clipboard-text"` | Copy concatenated text to the clipboard (up to an internal size limit).  |
| `"clipboard-file"` | Write the file to disk **and** copy a *file reference* to the clipboard. |
| `"terminal"`       | Print the concatenated Markdown to stdout.                               |

---

## ðŸ§© Example configuration

```jsonc
{
  "root.paths": [ "." ],
  "output.path": "~/Documents/context.md",
  "output.mode": "clipboard-file",
  "include.files": [
    "*.jl",
    "*.md",
    "*Project.toml",
    "*SourceConcat.json"
  ],
  "exclude.files": [
    "_DEPRECATED/**",
    ".git/**",
    "dev/**"
  ],
  "use.gitignore": true
}
```

### Main keys

| Key             | Type             | Description                                                            |
| --------------- | ---------------- | ---------------------------------------------------------------------- |
| `root.paths`    | `Vector{String}` | Root directories to walk                                               |
| `output.path`   | `String`         | Destination Markdown path                                              |
| `output.mode`   | `String`         | One of: `"file"`, `"clipboard-text"`, `"clipboard-file"`, `"terminal"` |
| `include.files` | `Vector{String}` | Glob patterns to include                                               |
| `exclude.files` | `Vector{String}` | Glob patterns to exclude                                               |
| `use.gitignore` | `Bool`           | When `true`, patterns in `.gitignore` are respected for exclusion      |

> **Config filenames:** either `SourceConcat.json` or `SrcConcat.json` is recognized.

---

## ðŸ§  Example output

```markdown
<!-- Generated by SourceConcat.jl at 2025-11-08 10:15:44 -->

***
## TABLE OF CONTENTS
1. [Content of 'Project.toml'](#sc-1)
2. [Content of 'src/SourceConcat.jl'](#sc-2)
...
```

---

## ðŸ–¥ï¸ Shell alias / function (Bash)

Add one of these to your `~/.bashrc` or `~/.zshrc`.

### Minimal alias (runs in current directory)

```bash
alias srcconcat='julia -e "using SourceConcat; SourceConcat.concat()"'
```

Usage:

```bash
# From a repo that has SourceConcat.json
srcconcat
```

### Small helper function

```bash
srcconcat() {
    # global
    julia -e 'using SourceConcat; SourceConcat.concat()'
}
```

Examples:

```bash
# Use the active environment
srcconcat
```

> The function simply invokes `SourceConcat.concat()` in the current working directory, where the tool will look for `SourceConcat.json`.
---

## ðŸ“‹ Clipboard file support

When `output.mode` is `"clipboard-file"`, the Markdown is written to disk and a **file reference** is copied to your clipboard, so you can paste directly into a AI chat as an attachment.

| Platform    | Backend             | Details                                                                        |
| ----------- | ------------------- | ------------------------------------------------------------------------------ |
| **macOS**   | `osascript`         | AppleScript: `set the clipboard to POSIX file "..."`                           |
| **Windows** | `PowerShell`        | Uses `.NET` `System.Windows.Forms.Clipboard` via STA thread                    |
| **Linux**   | `wl-copy` / `xclip` | GNOME-compatible `x-special/gnome-copied-files`, falls back to `text/uri-list` |

Implementation: `src/utils.clipboard.file.jl`

---

## ðŸ§ª Development

```julia
using Pkg
Pkg.test("SourceConcat")
```

Planned:

* Nested `.gitignore` parsing and `!pattern` support
* Parallel reading for large trees
* Command-line interface
* HTML / JSON export options

---

## ðŸ§± Project structure

```
SourceConcat.jl/
â”œâ”€â”€ Project.toml
â”œâ”€â”€ SourceConcat.json          # example configuration
â”œâ”€â”€ data/
â”‚   â””â”€â”€ SourceConfig.example.json
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ SourceConcat.jl
â”‚   â”œâ”€â”€ base.*.jl
â”‚   â”œâ”€â”€ utils.clipboard.file.jl
â”‚   â”œâ”€â”€ utils.gitignore.jl
â”‚   â””â”€â”€ utils.config.example.jl
â”œâ”€â”€ test/
â”‚   â””â”€â”€ runtests.jl
â””â”€â”€ notes/
```

---

## ðŸ“„ License

MIT Â© 2025 [JosÃ© Pereiro](mailto:jose.pereiro.lab@gmail.com)
